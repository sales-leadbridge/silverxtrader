<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SilverX Elite AI | Final Bot</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --royal: #2563eb; --cyan: #00d2ff; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #ffffff; color: #0f172a; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
        
        /* AD SYSTEM */
        #ad-overlay { display: none; position: fixed; inset: 0; background: white; z-index: 9999999; flex-direction: column; }
        .ad-nav { padding: 15px; display: flex; justify-content: space-between; border-bottom: 2px solid #f1f5f9; }
        .ad-close { font-size: 24px; color: #cbd5e1; display: none; cursor: pointer; }

        /* UI COMPONENTS */
        .pair-card { background: #eff6ff; border: 3px solid #bfdbfe; border-radius: 35px; padding: 20px; margin-bottom: 12px; text-align: center; }
        .section-divider { border-top: 2px solid #e2e8f0; border-bottom: 2px solid #e2e8f0; padding: 15px 0; margin: 25px 0; background: #f8fafc; }
        .ai-chamber { width: 100%; height: 180px; background: #0f2a3f; border-radius: 30px; position: relative; overflow: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 4px solid #fff; }
        
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 100000; align-items: center; justify-content: center; padding: 15px; }
        .modal-box { background: white; width: 100%; max-width: 440px; border-radius: 35px; padding: 25px; max-height: 85vh; overflow-y: auto; }
        
        .btn-3d { border-radius: 18px; font-weight: 800; font-size: 11px; text-transform: uppercase; display: flex; align-items: center; justify-content: center; gap: 8px; border-bottom: 5px solid rgba(0,0,0,0.15); padding: 15px; }
        .tab-active { background: var(--royal) !important; color: white !important; }

        .sidebar { position: fixed; left: -100%; top: 0; width: 80%; height: 100%; background: white; z-index: 200000; transition: 0.4s; padding: 25px; box-shadow: 20px 0 50px rgba(0,0,0,0.1); }
        .sidebar-active { left: 0 !important; }
    </style>
</head>
<body class="bg-slate-50">

    <div id="ad-overlay">
        <div class="ad-nav">
            <span id="timer-text" class="font-bold text-blue-600 bg-blue-50 px-4 py-1 rounded-full text-sm">CONNECTING...</span>
            <i class="fas fa-times ad-close" id="ad-x-icon" onclick="closeAdPopup()"></i>
        </div>
        <iframe id="ad-frame" src="" style="width:100%; height:100%; border:none;"></iframe>
    </div>

    <header class="sticky top-0 z-[50000] bg-white border-b px-5 py-3 flex justify-between items-center">
        <div class="flex items-center gap-2">
            <div class="w-9 h-9 bg-slate-900 rounded-lg flex items-center justify-center border-2 border-amber-400"><i id="crown" class="fas fa-crown text-slate-400 text-sm"></i></div>
            <h1 class="font-black text-base uppercase">SilverX <span class="text-blue-600">Pro</span></h1>
        </div>
        <i onclick="document.getElementById('sidebar').classList.add('sidebar-active')" class="fas fa-bars-staggered text-xl cursor-pointer"></i>
    </header>

    <div id="sidebar" class="sidebar">
        <div class="flex justify-between items-center mb-10">
            <h2 class="text-xl font-black">SilverX Menu</h2>
            <i onclick="document.getElementById('sidebar').classList.remove('sidebar-active')" class="fas fa-times text-2xl text-slate-300"></i>
        </div>
        <button onclick="openModal('privacy-modal')" class="w-full p-4 bg-blue-50 text-blue-600 rounded-2xl font-black text-xs text-left mb-4 uppercase">Privacy Policy</button>
        <button onclick="auth.signOut().then(()=>location.reload())" class="w-full p-4 bg-red-50 text-red-500 rounded-2xl font-black text-xs uppercase">Sign Out</button>
    </div>

    <main class="px-5 py-4">
        <div class="bg-slate-900 text-white p-6 mb-5 border-b-8 border-orange-500 rounded-[40px] flex justify-between items-center shadow-2xl">
            <div>
                <p class="text-[10px] font-black text-amber-400 uppercase mb-1">Status: <span id="tier">Checking...</span></p>
                <h4 class="text-3xl font-black"><span id="pts">0</span> <span class="text-xs text-white/50 uppercase">Pts</span></h4>
            </div>
            <button onclick="openModal('withdraw-modal')" class="bg-white text-slate-900 text-[10px] font-black px-5 py-2 rounded-xl">WITHDRAW</button>
        </div>

        <div class="grid grid-cols-2 gap-3 mb-6">
            <button onclick="openModal('vip-modal')" class="btn-3d bg-amber-400 text-black shadow-lg"><i class="fas fa-gem"></i> VIP Access</button>
            <button onclick="openModal('rec-modal')" class="btn-3d bg-orange-600 text-white shadow-lg"><i class="fas fa-heart-pulse"></i> Recovery</button>
        </div>

        <div class="section-divider">
            <div class="flex gap-2 px-5">
                <button onclick="switchTerminal('qx')" id="sw-qx" class="btn-3d flex-1 bg-white border border-slate-200 tab-active">Quotex Bot</button>
                <button onclick="switchTerminal('po')" id="sw-po" class="btn-3d flex-1 bg-white border border-slate-200">Pocket Bot</button>
            </div>
        </div>

        <div id="qx-grid" class="space-y-4 mb-10"></div>
        <div id="po-grid" class="hidden space-y-4 mb-10"></div>
    </main>

    <div id="withdraw-modal" class="modal-overlay">
        <div class="modal-box text-center">
            <h2 class="text-2xl font-black mb-6 uppercase">Withdraw Funds</h2>
            <input type="text" id="wd-address" placeholder="Binance Pay ID / USDT Address" class="w-full p-4 bg-slate-100 rounded-xl mb-3 font-bold">
            <input type="number" id="wd-amount" placeholder="Min 5000 Points" class="w-full p-4 bg-slate-100 rounded-xl mb-6 font-bold">
            <button onclick="submitWithdraw()" class="w-full py-4 bg-blue-600 text-white rounded-2xl font-black uppercase shadow-xl">Request Payout</button>
            <button onclick="closeModals()" class="mt-4 text-slate-400 font-bold uppercase text-xs">Cancel</button>
        </div>
    </div>

    <div id="privacy-modal" class="modal-overlay">
        <div class="modal-box">
            <h2 class="text-xl font-black text-blue-600 mb-4 text-center">Institutional Policy</h2>
            <div id="policy-content" class="h-80 overflow-y-auto text-[10px] text-slate-500 leading-relaxed">
                </div>
            <button onclick="closeModals()" class="w-full py-4 bg-slate-900 text-white rounded-2xl font-black mt-6">I Agree</button>
        </div>
    </div>

    <div id="vip-modal" class="modal-overlay">
        <div class="modal-box text-center">
            <h2 class="text-2xl font-black mb-1">VIP ACCESS</h2>
            <div class="bg-slate-900 text-white p-5 rounded-3xl my-6">
                <p class="text-[10px] text-slate-400">Binance Pay ID</p>
                <p class="text-xl font-black select-all">403009858</p>
            </div>
            <input type="text" id="vip-txid" placeholder="Transaction ID (TxID)" class="w-full p-4 bg-slate-100 rounded-xl mb-4 font-bold">
            <button onclick="submitVip()" class="w-full py-4 bg-amber-400 text-black rounded-2xl font-black uppercase shadow-xl">Activate VIP</button>
            <button onclick="closeModals()" class="mt-4 text-slate-400 font-bold text-xs uppercase">Close</button>
        </div>
    </div>

    <script>
        // --- CONFIG ---
        const firebaseConfig = { apiKey: "AIzaSyAyXzJ1UUdtWe96NjiQbVCqnWdIv8XakhA", authDomain: "silverxtrader.firebaseapp.com", projectId: "silverxtrader", storageBucket: "silverxtrader.firebasestorage.app", messagingSenderId: "46330013690", appId: "1:46330013690:web:c2aad241ad7abd49e0e643" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(); const auth = firebase.auth();
        emailjs.init("zqFa81v7RThJXvikM");

        const pairs = ["EUR/USD", "GBP/USD", "USD/JPY", "AUD/USD", "USD/CAD", "EUR/GBP", "NZD/USD", "USD/CHF", "EUR/JPY", "GBP/JPY", "BTC/USD", "ETH/USD", "SOL/USD", "XRP/USD", "LTC/USD", "DOGE/USD"];

        // --- RENDER ---
        function render(b) {
            const grid = document.getElementById(`${b}-grid`);
            pairs.forEach((p, i) => {
                const card = document.createElement('div');
                card.className = 'pair-card'; card.id = `${b}-${i}`;
                card.innerHTML = `<h3 class="text-lg font-black mb-1">${p}</h3><div class="ai-chamber mx-auto mb-4"><p class="text-[10px] text-green-400 font-bold">ACCURACY: 95%</p><p class="text-[10px] text-white">STATUS: WINNING</p></div><button onclick="handleSignal('${b}-${i}')" id="btn-${b}-${i}" class="btn-3d w-full bg-slate-900 text-white">GET SIGNAL</button>`;
                grid.appendChild(card);
            });
        }
        render('qx'); render('po');

        // --- LOGIC ---
        let userPoints = 0; let userStatus = "Free";
        auth.onAuthStateChanged(u => {
            if(!u) window.location.href = 'index.html';
            db.collection("users").doc(u.uid).onSnapshot(d => {
                if(d.exists) {
                    const data = d.data();
                    userPoints = data.points || 0;
                    userStatus = data.status || "Free";
                    document.getElementById('pts').innerText = userPoints;
                    document.getElementById('tier').innerText = userStatus;
                    if(userStatus === "VIP") document.getElementById('crown').classList.replace('text-slate-400', 'text-amber-500');
                }
            });
        });

        // --- AD & SIGNAL ---
        function handleSignal(id) {
            // Reset Ad State
            document.getElementById('ad-x-icon').style.display = 'none';
            document.getElementById('timer-text').innerText = "CONNECTING...";
            
            if(userStatus === "VIP") { revealSignal(id); } else {
                document.getElementById('ad-frame').src = "https://www.effectivegatecpm.com/zu9fwwufi?key=5c01f6e26f4b9943913f0d36bfa48f6d";
                document.getElementById('ad-overlay').style.display = 'flex';
                let t = 10;
                const int = setInterval(() => {
                    t--; document.getElementById('timer-text').innerText = `VERIFYING: ${t}s`;
                    if(t <= 0) { clearInterval(int); document.getElementById('ad-x-icon').style.display = 'block'; document.getElementById('timer-text').innerText = "VERIFIED ✅"; }
                }, 1000);
                window.currentSignalId = id;
            }
        }

        function closeAdPopup() {
            document.getElementById('ad-overlay').style.display = 'none';
            revealSignal(window.currentSignalId);
            // Points Logic
            db.collection("users").doc(auth.currentUser.uid).set({ points: firebase.firestore.FieldValue.increment(1) }, { merge: true });
        }

        function revealSignal(id) {
            const btn = document.getElementById(`btn-${id}`);
            btn.innerText = "1 MIN BUY ↑"; btn.classList.add('bg-green-500');
            setTimeout(() => { btn.innerText = "GET SIGNAL"; btn.classList.remove('bg-green-500'); }, 10000);
        }

        // --- SUBMISSIONS (FIREBASE + MAIL) ---
        async function submitWithdraw() {
            const addr = document.getElementById('wd-address').value;
            const amt = parseInt(document.getElementById('wd-amount').value);
            if(amt < 5000 || amt > userPoints) return alert("Invalid Points!");

            try {
                // 1. Save to Firebase
                await db.collection("withdraw_requests").add({
                    email: auth.currentUser.email,
                    uid: auth.currentUser.uid,
                    address: addr,
                    points: amt,
                    time: new Date()
                });

                // 2. Send Email
                emailjs.send("service_sqtahae", "template_itgty5n", {
                    from_email: auth.currentUser.email,
                    points: amt,
                    address: addr
                });

                alert("Withdrawal Request Sent Successfully!");
                closeModals();
            } catch (e) { alert("Error: " + e.message); }
        }

        async function submitVip() {
            const tid = document.getElementById('vip-txid').value;
            if(!tid) return alert("Enter TxID");

            try {
                await db.collection("vip_requests").add({
                    email: auth.currentUser.email,
                    uid: auth.currentUser.uid,
                    txid: tid,
                    time: new Date(),
                    status: "pending"
                });
                alert("VIP Request Submitted! Admin will verify soon.");
                closeModals();
            } catch (e) { alert("Data save error!"); }
        }

        // --- UI HELPERS ---
        function openModal(id) {
            document.getElementById(id).style.display = 'flex';
            document.getElementById('sidebar').classList.remove('sidebar-active');
            document.body.style.overflow = 'hidden';
        }
        function closeModals() {
            document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none');
            document.body.style.overflow = 'auto';
        }
        function switchTerminal(b) {
            document.getElementById('qx-grid').classList.toggle('hidden', b !== 'qx');
            document.getElementById('po-grid').classList.toggle('hidden', b !== 'po');
            document.getElementById('sw-qx').classList.toggle('tab-active', b === 'qx');
            document.getElementById('sw-po').classList.toggle('tab-active', b === 'po');
        }
    </script>
</body>
</html>
